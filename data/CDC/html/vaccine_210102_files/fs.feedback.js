/***************************************
* @preserve
* ForeSee Web SDK: Feedback
* Built July 15, 19 08:48:23
* Code version: 19.7.6
* Template version: 19.7.6
***************************************/
_fsDefine(["require","fs",_fsNormalizeUrl("$fs.utils.js"),_fsNormalizeUrl("$fs.survey.js"),"feedbackconfig"],function(i,fs,utils,k,_){var e=fs.toLowerCase(window.location.href.toString()),s={};if((-1<e.indexOf("buildabear.c")||-1<e.indexOf("bab-dev-store.sparkred.")||-1<e.indexOf("humana.c")||e.indexOf(".dteenergy.c"))&&(s.FBALTPOSITION=!0),(-1<e.indexOf(".peco.c")||-1<e.indexOf(".bge.com")||-1<e.indexOf(".comed.com"))&&(s.FBALTOVERFLOW=!0),!(-1<e.indexOf("argos.co")&&window!==window.top)){var C={config:JSON.parse(JSON.stringify(_)),onFeedbackSubmitted:new utils.FSEvent,onFeedbackShown:new utils.FSEvent,onFeedbackClosed:new utils.FSEvent,onModalCssRetrieved:new utils.FSEvent};if(fs.fsCmd("feedbackreport")||fs.supportsDomStorage&&"true"==sessionStorage.getItem("fsFeedbackLoaded"))return fs.supportsDomStorage&&sessionStorage.setItem("fsFeedbackLoaded","true"),void i([fs.makeURI("$fs.feedbackreport.js")],function(e){});function f(e){if("string"==typeof e&&-1==e.indexOf("<"))return document.querySelectorAll(e);if("string"==typeof e){var t=document.createElement("div");t.innerHTML=e,e=t.firstChild}for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i]);return e}function a(e,t){return new window.Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');")(t||{})}function d(e){var t,i=window._acsURL||window.location.toString();function s(e){if(!Array.isArray(e))return!1;for(t=0;t<e.length;t++)if(utils.testAgainstSearch(e[t],i))return!0;return!1}return i=fs.toLowerCase(i),(!e.whitelistActive||s(e.whitelistData))&&(!e.blacklistActive||!s(e.blacklistData))}function S(e,t,i,s,n,r){this.cfg=e,this.cpps=i,this.jrny=e.jrny;var o,a="acsFeedbackResultsCounter",c=e.previewMode?e.previewMode.toLowerCase():"";this.btncfg=e,this.badgeClicked=new utils.FSEvent,this.surveyTriggered=new utils.FSEvent,this.br=t,e.devices&&e.devices.overridesEnabled&&(o=t.isTablet||"tablet"===c?e.devices.tablet:t.isMobile||"mobile"===c?e.devices.mobile:e.devices.desktop,fs.ext(this.cfg,o),-1<this.cfg.icon.lastIndexOf(".png")&&(this.btncfg.icon=this.cfg.icon.replace(".png",".svg")));this.animationMove=4,e.counter&&(this.counter=0,sessionStorage.getItem(a)&&(this.counter=Math.round(parseFloat(sessionStorage.getItem(a))),this.counter=isNaN(this.counter)?0:this.counter),this.btncfg.counter=this.counter,this.btncfg.counterLocale=e.counter.toLocaleString()),this.btncfg.fbsize=this.cfg.fbsize||"medium",this.btncfg.btnClass="_acs _acs"+e.fbtype+"--"+e.template+" _acsbadge--"+this.btncfg.fbsize+" _acs"+e.fblocation,this.btncfg.fbcolortext=this.btncfg.fbcolortext||"#fff",this.btnTemplate=s,this.emtemplate=n,this.enabled=!!r}var n={remove:function(){this.parentNode&&this.parentNode.removeChild(this)},hasClass:function(e){return-1<this.className.indexOf(e)},addClass:function(e){this.hasClass(e)||(this.className+=" "+e)},removeClass:function(e){this.className=(this.className||"").replace(e,""),this.className=this.className.replace(/[ ]+$/g,"")},$:function(e){return this.querySelectorAll(e)},css:function(e){for(var t in e)e.hasOwnProperty(t)&&(this.style[t]=e[t])}};S.prototype.setBtnTemplate=function(){var e={btncfg:this.btncfg},t=a(this.btnTemplate,e),i=this;i.badgeClicked.subscribe(function(){i.jrny&&i.jrny.addEventObj({name:"feedback_clicked"+(i.br.isMobile?"_mobile":""),properties:{mid:[i.cfg.mid]}}),i.surveyTriggered.fire({emtemplate:i.emtemplate})},!1,!0),this.$el=document.createElement("div"),this.$el.innerHTML=t,this.$el=f(this.$el.querySelectorAll("div._acs")[0]),this.enabled&&(utils.Bind(this.$el,"feedback:click",function(){i._unhover(),i.badgeClicked.fire(i.cfg)}),utils.Bind(this.$el,"feedback:keypress",function(e){var t=utils.getKeyCode(e);"enter"!==t&&" "!==t&&"spacebar"!==t||(i._unhover(),i.badgeClicked.fire(i.cfg))})),this.cfg.fbanimate&&(utils.Bind(this.$el,"feedback:mouseenter",function(){i._hover()}),utils.Bind(this.$el,"feedback:mouseleave",function(){i._unhover()})),this.btncfg.label.length||(this.$el.querySelector("._acsBadgeLabel").style.paddingLeft=0),document.body.appendChild(this.$el),s&&!s.FBALTPOSITION&&utils.addClass(document.documentElement,"fsfb fsfb-relbody"),this.cfg.delay&&0<this.cfg.delay?setTimeout(function(){this.init()}.bind(this),this.cfg.delay):this.init()},S.prototype._hover=function(){this.cfg.fbanimate&&this.$el.addClass("_acsHover")},S.prototype._unhover=function(){this.cfg.fbanimate&&this.$el.removeClass("_acsHover")},S.prototype.init=function(e){var t=this.$el.$("._acsBadgeLabel"),i=this,s=(i.cfg,utils.getGeneralStorage(this.br));if(e=e||function(){},i.jrny&&!s.get("fbb")&&(s.set("fbb","s",864e5),i.jrny.addEventObj({name:"feedback_button_shown",properties:{mid:[i.cfg.mid]}})),this.$el.css({visibility:"hidden"}),t&&0<t.length){if(e){var n=this.$el;setTimeout(function(){i._unhover(),setTimeout(function(){n.addClass("_acsAnimate"),e()},250)},250),"vertical"==this.cfg.fbdirection&&(-1<this.cfg.fblocation.indexOf("right")?this.$el.addClass("_acsVertical_right"):this.$el.addClass("_acsVertical_left")),this.cfg.fbfixed&&this.$el.addClass("_acsFixed")}"none"===this.cfg.fbtype?this.$el.css({display:"none"}):this.$el.css({visibility:"visible"}),i.br.isMobile&&this.$el.setAttribute("role","link")}},S.prototype.remove=function(){this.enabled=!1,this.$el&&this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)},S.prototype.dispose=function(){this.remove(),this.disposed=!0};function $(e,t){e=e||this.cfg,t=t||this.br;var i=e.previewMode?e.previewMode.toLowerCase():"",s=e.fbtype;return e&&t&&e.devices&&e.devices.overridesEnabled&&(s=t.isTablet||"tablet"===i?e.devices.tablet.fbtype||e.fbtype:t.isMobile||"mobile"===i?e.devices.mobile.fbtype||e.fbtype:e.devices.desktop.fbtype||e.fbtype),s}var h,l,r=new utils.FSEvent;fs.API.expose("CPPS",{set:function(){var e;r.subscribe((e=arguments,function(){C.CPPS.set.apply(C.CPPS,e)}),!0,!0)},get:function(e,t){var i;t=t||console.log||function(){},r.subscribe((i=[arguments],function(){t(C.CPPS.get.apply(C.CPPS,i[0]))}),!0,!0)},all:function(e){e=e||console.table||console.log||function(){},r.subscribe(function(){e(C.CPPS.all.apply(C.CPPS))},!0,!0)}}),fs.API.expose("clearStateFeedback",function(){r.subscribe(function(){C.stg.reset(),C.rec&&C.rec.recorder&&C.rec.recorder.clearState()},!0,!0)});function t(e){var t=!1,i=!1,s=_.instances;clearTimeout(h),clearTimeout(l),utils._preventUnloadFor(500);for(var n=0;n<s.length;n++)if(s[n].mid==e){t=s[n];break}if(t&&t.disabled)return"This feedback has been disabled.";if(t.topics&&t.topics.length)for(var r=0;r<t.topics.length;r++)if(d(t.topics[r])){i=!0;break}if(!t)return"Error: MID provided is not valid";if(!i&&0!==t.topics.length)return"Error: Either this measure is disabled or there are no active topics";if((i||0===t.topics.length)&&!t.disabled){if(t.surveytype||void 0===t.popup||(t.surveytype=t.popup?"popup":"modal"),t.template||(t.template="default"),"popup"==I.computeSurveyType(t.surveytype))return void I.initialize(t,C.browser,C.CPPS);function o(e,t,i,s){var n=fs.makeURI("$templates/feedback/"+(e||"default")+"/"+t+".html");new utils.JSONP({success:function(e){s(e),i&&i.resolve()}.bind(this),failure:function(e){i&&i.error()}.bind(this)}).get(n,"templates_feedback_"+(e||"default")+"_")}var a={},c=new utils.Async(!0,function(){void 0===C.browser&&(C.browser=new utils.Browser),void 0===C.CPPS&&(C.CPPS=new utils.CPPS(utils.getGeneralStorage(C.browser)));I.initialize(t,C.browser,C.CPPS,a.emTemplate,a.svContentsTemplate,a.epTemplate)}.bind(this),function(){}.bind(this));c.enqueue(function(e){utils.loadCSS(fs.makeURI("$templates/feedback/"+(this.template||"default")+"/main.css"),function(){C.onModalCssRetrieved.fire(),e&&e.resolve()},function(){e&&e.error()})}),c.enqueue(function(e){o(t.template,"epilogue",e,function(e){a.epTemplate=e})}),c.enqueue(function(e){o(t.template,"surveycontents",e,function(e){a.svContentsTemplate=e})}),c.enqueue(function(e){o(t.template,"serviceunavailable",e,function(e){a.emTemplate=e})})}}fs.API.expose("launchFeedback",t),fs.API.expose("launchACSFeedback",t),fs.API.expose("resetFeedback",function(){clearTimeout(l),h&&(clearTimeout(h),h=null),h=setTimeout(function(){for(h=null;0<P.length;){var e=P.pop();e.badge&&e.badge.dispose()}utils.Unbind("feedback:*"),utils.Unbind("feedbackModal:*"),utils.pageNavEvent.unsubscribe(C.pageResetFn),B.dispose(),I.disposePopups(),l=fs.nextTick(function(){v()})},200)}),fs.API.expose("onFeedbackSubmitted",C.onFeedbackSubmitted),fs.API.expose("onFeedbackShown",C.onFeedbackShown),fs.API.expose("onFeedbackClosed",C.onFeedbackClosed);function o(){var e=f('<img src="'+fs.makeURI("$loader.gif")+'" class="acs-loader">');e.setAttribute("alt","loading survey"),this.$el=e}var T=function(e,t,i){C.CPPS=e,C.browser=t,C.stg=i,r.fire()};o.prototype.center=function(e){var t=this.$el.parentNode.offsetWidth,i=(this.$el.parentNode.offsetHeight,this.$el.offsetWidth);this.$el.offsetHeight;this.$el.css({left:(t-i)/2+"px",top:e?(t-i)/2+"px":"auto"})},o.prototype.remove=function(){this.$el.parentNode.removeChild(this.$el)};function E(e,t){this.br=e,this.cfg=t}E.prototype.platformOK=function(){var e=this.cfg,t=this.br;return!(e.browser_cutoff[t.browser.name]&&t.browser.actualVersion<e.browser_cutoff[t.browser.name])&&!(e.platform_cutoff[t.os.name]&&t.os.version<e.platform_cutoff[t.os.name])};function c(e,t,i){this.template=i,this.br=e,this.cpps=t,this.emTemplate=null,this.css=null,this.typeTemplate=null,this.svContentsTemplate=null,this.epTemplate=null}c.prototype.getCss=function(t){utils.loadCSS(fs.makeURI("$templates/feedback/"+(this.template||"default")+"/main.css"),function(e){e?(t&&t.resolve(),C.onModalCssRetrieved.fire()):t&&t.error()},null,this.br)},c.prototype.getTemplate=function(e,t,i){var s=fs.makeURI("$templates/feedback/"+(this.template||"default")+"/"+e+".html"),n="templates_feedback_"+(this.template||"default")+"_";new utils.JSONP({success:function(e){i&&i(e),t&&t.resolve()}.bind(this),failure:function(e){t&&t.error()}.bind(this)}).get(s,n)},c.prototype.grabTemplates=function(e){this.queue=new utils.Async(!0,function(){e&&e({typeTemplate:this.typeTemplate,emTemplate:this.emTemplate,epTemplate:this.epTemplate,svContentsTemplate:this.svContentsTemplate})}.bind(this),function(){}.bind(this)),this.queue.enqueue(function(e){this.getCss(e)}.bind(this)),this.queue.enqueue(function(e){this.getTemplate("badge",e,function(e){this.typeTemplate=e}.bind(this))}.bind(this)),this.queue.enqueue(function(e){this.getTemplate("serviceunavailable",e,function(e){this.emTemplate=e}.bind(this))}.bind(this)),this.queue.enqueue(function(e){this.getTemplate("epilogue",e,function(e){this.epTemplate=e}.bind(this))}.bind(this)),this.queue.enqueue(function(e){this.getTemplate("surveycontents",e,function(e){this.svContentsTemplate=e}.bind(this))}.bind(this))};function j(e,t,i){this.br=e,this.cpps=t,this.templateHolder={},this.loadSuccess=new utils.FSEvent,this.loadFailure=new utils.FSEvent;for(var s=new utils.Async(!0,function(){this.loadSuccess.fire(this.templateHolder)}.bind(this),function(){this.loadFailure.fire()}.bind(this)),n=0;n<i.length;n++)s.enqueue(function(i){return function(t){new c(this.br,this.cpps,i).grabTemplates(function(e){e?(this.templateHolder[i]=e,t.resolve()):t.error()}.bind(this))}}(i[n]).bind(this))}function p(e,t,i,s,n,r){this.sv=e,this.br=t,this.cfg=i,this.jrny=i.jrny,this.errTemplate=s,this.svTemplate=n,this.epTemplate=r,this.$domContent=[],this.$btns=[],this.networkError=new utils.FSEvent,this.SurveySubmitted=new utils.FSEvent,this.ajax=new utils.AjaxTransport;for(var o=o||window,a=o.document.body.childNodes,c=0;c<a.length;c++)1===a[c].nodeType&&f(a[c]).hasClass("_acs")?this.$btns.push(a[c]):this.$domContent.push(a[c]);this.$el=f('<div class="acsMainContainerFullPage--'+this.sv.cfg.template+'"></div>'),this.sv.cfg.privacyuri=this.sv.cfg.privacyuri?this.sv.cfg.privacyuri:"http://www.foresee.com/about-us/privacy-policy/",this.sv.cfg.privacytext=this.sv.cfg.privacytext?this.sv.cfg.privacytext:"Privacy policy",this.sv.SubmitClicked.subscribe(function(){this.$content.removeClass("acsVisible"),this._showWait(),this._postSurveyData(function(){this.jrny.addEventObj({name:"feedback_submitted",properties:{mid:[i.mid]}}),this.$content.addClass("acsVisible"),this._showThankyou(),this._removeWait(),this.SurveySubmitted.fire()}.bind(this))}.bind(this)),this.networkError.subscribe(this.onNetworkError.bind(this)),this._getSurveyData(function(e){this.survey=e,this.show()}.bind(this))}p.prototype.onNetworkError=function(e){this._removeWait(),e&&e.type?this.jrny&&this.jrny.addEventObj({name:"feedback_survey_"+e.type,properties:{mid:[k.cfg.mid]}}):this.jrny&&this.jrny.addEventObj({name:"feedback_server_error",properties:{mid:[k.cfg.mid]}}),this.$content=f('<div class="acsMainContainerMobile--'+this.sv.cfg.template+'"></div>'),this.$el=f('<div class="acsMainContainerFullPage--'+this.sv.cfg.template+'"></div>'),this.$closebtn=f('<span><img src="'+fs.makeURI("$templates/feedback"+(this.sv.cfg.template||"default")+"/closeBtn.svg")+'" class="acsModalCloseButton"></span>'),this.$content.innerHTML=a(this.errTemplate,this.survey);var t=this.$content.$(".acs-serviceunavailable__message")[0];if("expired"===e.type){for(;t.firstChild;)t.removeChild(t.firstChild);this.sv.cfg.fbexpiremessage?t.appendChild(f("<p>"+this.sv.cfg.fbexpiremessage+"</p>")):t.appendChild(f("<p>This is an expired survey!</p>"))}else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(f("<p>Feedback isn't available right now.</p><p>Please check back later.</p>"))}utils.Bind(this.$closebtn,"feedback:click",function(e){this.hide(e,!0)}.bind(this)),this.$el.appendChild(this.$closebtn),this.$el.appendChild(this.$content);var i=this.$el.$(".acs-close-button")[0];utils.Bind(i,"feedback:click",function(e){this.hide(e,!0)}.bind(this)),this.$content.addClass("acsVisible"),window.document.body.innerHTML="",window.document.body.appendChild(this.$el)},p.prototype._renderSurvey=function(){var e=e||window,t=(this.sv.cfg,this),i=e.document.body;if(!this.sv.cfg.preview){var s=function(e){27==e.keyCode&&(t.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[t.cfg.mid]}}),t.hide(e,!1)),utils.Unbind(document.body,"feedback:keyup",s)};utils.Bind(document.body,"feedback:keyup",s)}i.innerHTML="",0===this.$el.children.length&&(this.$closebtn=f('<span><img src="'+fs.makeURI("$templates/feedback/"+(this.sv.cfg.template||"default")+"/closeBtn.svg")+'" class="acsModalCloseButton"></span>'),this.$content=f('<div class="acsMainContainerMobile--'+this.sv.cfg.template+'"></div>'),this.$el.appendChild(this.$closebtn),this.$el.appendChild(this.$content)),i.appendChild(this.$el),this.sv.cfg.preview||utils.Bind(this.$closebtn,"feedback:click",function(e){this.hide(e,!1)}.bind(this)),this._showWait()},p.prototype._showWait=function(){this._removeWait(),this._wait=new o,this.$el.appendChild(this._wait.$el),this._wait.center();var e=utils.getScroll(window),t=utils.getSize(window);this._wait.$el.css({position:"absolute",top:e.y+(t.h-this._wait.$el.offsetHeight)/2+"px",left:e.x+(t.w-this._wait.$el.offsetWidth)/2+"px"})},p.prototype._removeWait=function(){this._wait&&(this._wait.remove(),this._wait=null)},p.prototype.hide=function(e,t){window.document.body.innerHTML="";for(var i=0;i<this.$domContent.length;i++)window.document.body.appendChild(this.$domContent[i]);C.onFeedbackClosed.fire(),this.jrny&&e&&e.target&&!e.target.classList.contains("acs-feedback__button--epilogue")&&this.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[this.cfg.mid]}}),t||this._showBtns()},p.prototype.remove=function(e){return this.hide(null,e)},p.prototype._showBtns=function(){for(var e=0;e<this.$btns.length;e++)window.document.body.appendChild(this.$btns[e])},p.prototype.show=function(){if(this._renderSurvey(),this._removeWait(),this.survey.ansLogoSrc=fs.makeURI("$p_b_foresee.svg"),0===this.$content.children.length){var e=a(this.svTemplate,this.survey);this.$content.innerHTML=e,this.sv.bind(this.$content)}this.$content.addClass("acsVisible"),this.$el.addClass("acsVisible"),this.sv.SurveyUIUpdated.fire(),C.onFeedbackShown.fire(this.$el),this.jrny&&this.jrny.addEventObj({name:"feedback_survey_shown",properties:{mid:[this.sv.cfg.mid]}})},p.prototype._showThankyou=function(){this._removeWait();var e=a(this.epTemplate,this.survey);this.$closebtn=f('<span><img src="'+fs.makeURI("$templates/feedback/"+(this.sv.cfg.template||"default")+"/closeBtn.svg")+'" class="acsModalCloseButton"></span>'),this.sv.cfg.preview||utils.Bind(this.$closebtn,"feedback:click",function(e){this.hide(e,!0)}.bind(this),!0),this.$content.innerHTML=e,this.jrny&&this.jrny.addEventObj({name:"feedback_thankyou_shown",properties:{mid:[this.cfg.mid]}}),this.$el.removeChild(this.$el.childNodes[0]),this.$el.removeChild(this.$el.childNodes[0]),this.$el.appendChild(this.$closebtn),this.$el.appendChild(this.$content);for(var t=this.$el.$(".acs-close-button")[0],i=this.$el.$("h1"),s=0;s<i.length;s++)f(i[s]).addClass("acs-feedback__heading acs-feedback__heading--h1");this.sv.cfg.preview||utils.Bind(t,"feedback:click",function(e){this.hide(e,!0)}.bind(this))},p.prototype._getSurveyData=function(){if(this.sv.isExpired())this.networkError.fire({type:"expired"});else{var e={mid:this.sv.cfg.mid,cachebust:(new Date).getTime()};this.sv.cfg.version&&(e.version=this.sv.cfg.version),this._surveyTimer=setTimeout(function(){this.networkError.fire({type:"timedout"})}.bind(this),1e4),this.ajax.send({method:"GET",url:this.cfg.datauri,data:e,success:function(e){clearTimeout(this._surveyTimer),this.sv.SurveyData.fire(e,function(e){this.survey=e,this.show()}.bind(this))}.bind(this),failure:function(e){this.networkError.fire({type:"getdata_failed"})}.bind(this)})}},p.prototype._postSurveyData=function(t){if(this.sv.cfg.preview)setTimeout(function(){t&&t()},100);else{this._surveyTimer=setTimeout(function(){this.networkError.fire({type:"timedout"})}.bind(this),1e4);var e=JSON.parse(this.sv._serialize());this.jrny&&this.jrny.config&&this.jrny.config.disable_cpps&&-1<this.jrny.config.disable_cpps.indexOf("url")&&(e.url=""),this.ajax.send({method:"POST",url:this.cfg.posturi,data:e,contentType:"application/json",success:function(e){clearTimeout(this._surveyTimer),t&&t()}.bind(this),failure:function(e){clearTimeout(this._surveyTimer),sessionStorage.setItem("acsFeedbackSubmitted","true"),this.networkError.fire({type:"postdata_failed"})}.bind(this)})}};function u(e,t,i,s,n,r){this.cfg=e,this.br=t,this.cpps=i,this.errortemplate=s,this.modaltemplate=n,this.eptemplate=r,this.jrny=e.jrny,this.init(),this.SurveySubmitted=new utils.FSEvent,this.NetworkError=new utils.FSEvent}u.prototype.init=function(){var e=this;switch(this.cfg.surveytype=I.computeSurveyType(this.cfg.surveytype),this.cfg.surveytype){case"popup":this.survey=new k.SurveyBuilder(this.cfg,this.cpps,this.br),this.chrome=new b(this.survey,this.cfg,this.br),this.chrome.SurveySubmitted.subscribe(function(){e.SurveySubmitted.fire(),C.onFeedbackClosed.fire()}),this.chrome.show();break;case"modal":fs.isDefined(this.chrome)?(this.chrome.show(),C.onFeedbackShown.fire()):(this.survey=new k.SurveyBuilder(this.cfg,this.cpps,this.br),this.chrome=new m(this.survey,this.br,this.cfg,this.errortemplate,this.modaltemplate,this.eptemplate),this.chrome.SurveySubmitted.subscribe(function(){e.SurveySubmitted.fire()}),this.chrome.networkError.subscribe(function(){e.NetworkError.fire()}));break;case"fullpage":fs.isDefined(this.chrome)?(this.chrome.show(),C.onFeedbackShown.fire()):(this.survey=new k.SurveyBuilder(this.cfg,this.cpps,this.br),this.chrome=new p(this.survey,this.br,this.cfg,this.errortemplate,this.modaltemplate,this.eptemplate),this.chrome.SurveySubmitted.subscribe(function(){e.SurveySubmitted.fire()}),this.chrome.networkError.subscribe(function(){e.NetworkError.fire()}))}},u.prototype.show=function(){this.chrome.show()},u.prototype.remove=function(){this.chrome&&this.chrome.remove&&this.chrome.remove()};function F(e){this.br=e,this.mid=utils.getHashParm("mid"),this.previewmode=fs.toLowerCase(utils.getHashParm("previewmode")),this.datauri=utils.getHashParm("datauri"),this.template=utils.getHashParm("template")||"default",this.surveytype=utils.getHashParm("surveytype")?utils.getHashParm("surveytype"):"modal",this.tempHolder={}}F.prototype.show=function(){if(this.mid&&this.previewmode&&this.datauri){var e=new j(this.br,{},[this.template]);e.loadSuccess.subscribe(function(e){this.tempHolder=e[this.template];I.initialize({mid:this.mid,datauri:this.datauri,posturi:"",reporturi:"",surveytype:this.surveytype,autowhitelist:!0,preview:!0,template:this.template,replay:!1},this.br,null,this.tempHolder.emTemplate,this.tempHolder.svContentsTemplate,this.tempHolder.epTemplate)}.bind(this)),e.loadFailure.subscribe(function(){}.bind(this))}else alert("You need mid, previewmode, and datauri.")};function x(e,t,i,s){this.cfg=e,this.br=t,this.cpps=i,this.cfg.template=void 0!==this.cfg.template?this.cfg.template:"default",this.cfg.surveytype=void 0!==this.cfg.surveytype?this.cfg.surveytype:"modal",this.cfg.fbcolor=void 0!==this.cfg.fbcolor?this.cfg.fbcolor:"#F24554",this.cfg.fbcolortext=void 0!==this.cfg.fbcolortext?this.cfg.fbcolortext:"#FFFFFF",this.cfg.replay=void 0!==this.cfg.replay&&this.cfg.replay}x.prototype.renderBadge=function(){var e=new j(this.br,this.cpps,[this.cfg.template]);e.loadSuccess.subscribe(function(e){var t=e[this.cfg.template];this.cfg.badge=new S(this.cfg,this.br,this.cpps,t.typeTemplate,t.emTemplate,!1),this.cfg.badge.setBtnTemplate()}.bind(this)),e.loadFailure.subscribe(function(){}.bind(this))};var I={Current:null,getPopup:function(e){return!(utils.getSize(window).w<=500)&&(!(!I.Current||I.Current.cfg.mid!=e)&&I.Current)},disposePopups:function(){I.Current&&I.Current.remove(),I.Current=null},removePopup:function(e){I.Current&&I.Current.cfg.mid==e&&(I.Current.remove(),I.Current=null)},initialize:function(e,t,i,s,n,r){I.disposePopups(),e.surveytype||void 0===e.popup||(e.surveytype=e.popup?"popup":"modal");var o,a=I.getPopup(e.mid);return a&&!a.cfg.popup?a.show():(a=new u(e,t,i,s,n,r),(I.Current=a).SurveySubmitted.subscribe((o=e,function(){I.SurveySubmitted.fire(o)})),a.NetworkError.subscribe(function(){I.NetworkError.fire()})),a},computeSurveyType:function(e){return"fullpage"!==e&&(C.browser.isMobile||utils.getSize(window).w<=500)?"popup":e}};I.SurveySubmitted=new utils.FSEvent,I.NetworkError=new utils.FSEvent;var m=function(e,t,i,s,n,r){this.sv=e,this.cfg=e.cfg,this.instcfg=i,this.browser=t,this.em=s,this.noserv=s,this.eptemplate=r,this.jrny=e.cfg.jrny,this.add(),this.modaltemplate=n,this.ajax=new utils.AjaxTransport,this.sv.cfg.privacyuri=this.sv.cfg.privacyuri?this.sv.cfg.privacyuri:"http://www.foresee.com/about-us/privacy-policy/",this.sv.cfg.privacytext=this.sv.cfg.privacytext?this.sv.cfg.privacytext:"Privacy policy",this.SurveySubmitted=new utils.FSEvent,this.networkError=new utils.FSEvent;this.sv.SubmitClicked.subscribe(function(){this.$content.removeClass("acsVisible"),this._showWait(),this._postSurveyData(function(){this.jrny&&this.jrny.addEventObj({name:"feedback_submitted",properties:{mid:[this.cfg.mid]}}),this.$content.addClass("acsVisible"),this._showThankyou(),this.SurveySubmitted.fire(),this._removeWait()}.bind(this))}.bind(this)),this.networkError.subscribe(function(e){this._removeWait(),e&&e.type?this.jrny&&this.jrny.addEventObj({name:"feedback_survey_"+e.type,properties:{mid:[this.cfg.mid]}}):this.jrny&&this.jrny.addEventObj({name:"feedback_server_error",properties:{mid:[this.cfg.mid]}}),this.$content.innerHTML=a(this.noserv,this.survey);var t=this.$content.$("h1"),i=this.$content.$(".acs-close-button")[0],s=this.$content.$(".acs-serviceunavailable__message")[0];if("expired"===e.type){for(;s.firstChild;)s.removeChild(s.firstChild);if(this.sv.cfg.fbexpiremessage)s.appendChild(f("<p>"+this.sv.cfg.fbexpiremessage+"</p>"));else{var n=this._unencodeHTML(this.sv.defaultCfg.expired);s.appendChild(f(n))}}else{for(;s.firstChild;)s.removeChild(s.firstChild);var r=this._unencodeHTML(this.sv.defaultCfg.unavailable);s.appendChild(f(r))}for(var o=0;o<t.length;o++)f(t[o]).addClass("acs-feedback__heading acs-feedback__heading--h1");this.cfg.preview||(this.positionModal(),utils.Bind(i,"feedbackModal:click",function(){this.remove()}.bind(this))),this.$content.addClass("acsVisible")}.bind(this)),this._getSurveyData()};m.prototype._showThankyou=function(){var e=a(this.eptemplate,this.survey);this.$content.innerHTML=e;for(var t=this.$content.$("h1"),i=this.$content.$(".acs-close-button")[0],s=document.getElementById("fsrModalFocus"),n=0;n<t.length;n++)utils.addClass(t[n],"acs-feedback__heading acs-feedback__heading--h1");this.positionModal(),this.cfg.preview||utils.Bind(i,"feedbackModal:click",function(){this.remove()}.bind(this)),s.focus()},m.prototype._unencodeHTML=function(e){return e.replace(/&lt;/gi,"<").replace(/&gt;/gi,">")},m.prototype._showWait=function(){this._removeWait(),this._wait=new o,this.$el.appendChild(this._wait.$el),this._wait.center();var e=utils.getScroll(window),t=utils.getSize(window);this._wait.$el.css({top:e.y+(t.h-this._wait.$el.offsetHeight)/2+"px"})},m.prototype._removeWait=function(){this._wait&&(this._wait.remove(),this._wait=null)},m.prototype.remove=function(){this.$el&&this.$el.parentNode&&(utils.Unbind("feedbackModal:*"),this.$el.parentNode.removeChild(this.$el),C.onFeedbackClosed.fire(this.$el))},m.prototype.add=function(e){var t=(e=e||window).document.body,i=e.document.documentElement,s=Math.max(t.scrollHeight,t.offsetHeight,i.clientHeight,i.scrollHeight,i.offsetHeight),n="acsModalContainer--"+this.instcfg.template,r=this.sv.cfg,o=f('<div class="acsModalBackFace"></div>'),a=f('<div class="acsModalChrome"></div>');if(this.browser.isIE&&10==this.browser.browser.version&&(n+=" acsIE10"),this.$el=f('<div class="'+n+'"></div>'),this.$el.css({height:s}),!this.cfg.preview){var c=this;utils.Bind(o,"feedbackModal:click",function(e){(this.survey||this.networkError.didFire)&&(c.jrny&&c.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[r.mid]}}),this.remove())}.bind(this));utils.Bind(document.body,"feedbackModal:keyup",function(e){27==e.keyCode&&(c.jrny&&c.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[r.mid]}}),c.remove(),c.focusOnBadge())}),utils.Bind(a,"feedbackModal:click",function(e){var t=e.target;t&&t==a&&(c.jrny&&c.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[r.mid]}}),c.remove(),c.focusOnBadge())})}var d=this.head=f('<div class="acsModalContent" id="acsModalContent" role="dialog" aria-labelledby="acsFeedbackDialogTitle" aria-describedby="acsFeedbackDialogDesc"></div>'),h=f('<div class="acsModalHead" role="presentation"></div>'),l=f('<img id="fsrModalFocus" src="'+fs.makeURI("$templates/feedback/"+(this.instcfg.template||"default")+"/closeBtn.svg")+'" class="acsModalCloseButton" alt="Close Button" tabindex="0">');(this.$head=h).appendChild(l),d.appendChild(h),this.$content=f('<div class="acsModalInnerContent" role="presentation"></div>'),d.appendChild(this.$content),a.appendChild(d),this.$el.appendChild(o),this.$el.appendChild(a),e.document.body.appendChild(this.$el),this.cfg.preview||(utils.Bind(l,"feedbackModal:click",function(e){this.jrny&&this.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[this.cfg.mid]}}),this.remove(),this.focusOnBadge()}.bind(this)),utils.Bind(l,"feedbackModal:keypress",function(e){13!==e.keyCode&&"Enter"!==e.key||(this.jrny.addEventObj({name:"feedback_abandoned",properties:{mid:[this.cfg.mid]}}),this.remove(),this.focusOnBadge())}.bind(this))),fs.nextTick(function(){o.addClass("_acsActive")}),this._showWait(),this._trapKeyBoard(d,l)},m.prototype.renderSurvey=function(){var e;this._removeWait(),this.$head.addClass("acsVisible"),this.survey.ansLogoSrc=fs.makeURI("$p_b_foresee.svg"),this.survey.meta.prologuetext=this._addTitleDescIds(this.survey.meta.prologuetext),this.survey.meta.epiloguetext=this._addTitleDescIds(this.survey.meta.epiloguetext),e=a(this.modaltemplate,this.survey),this.$content.innerHTML=e,this.sv.bind(this.$content),this.positionModal(),this.$content.addClass("acsVisible"),C.onFeedbackShown.fire(this.$el),this.jrny&&this.jrny.addEventObj({name:"feedback_survey_shown",properties:{mid:[this.cfg.mid]}}),C.onModalCssRetrieved.subscribe(function(){document.getElementById("fsrModalFocus").focus()}.bind(this),!0,!0)},m.prototype._addTitleDescIds=function(e){var t=document.createElement("div");t.innerHTML=e;var i=t.childNodes[0],s=t.childNodes[1],n="";if(2<t.childNodes.length)for(t.removeChild(t.childNodes[0]),(s=document.createElement("div")).setAttribute("style","padding: 0; margin: 0;");t.hasChildNodes();){var r=t.firstChild;t.removeChild(r),s.appendChild(r)}return i.setAttribute("id","acsFeedbackDialogTitle"),n=i.outerHTML,s&&(s.setAttribute("id","acsFeedbackDialogDesc"),n+=s.outerHTML),n},m.prototype.positionModal=function(){var e,t=utils.getSize(window),i=this.$content.offsetHeight||this.prevOffsetHeight;t.h>i&&(e=Math.max(0,(t.h-i-50)/2)+"px"),this.head.style.marginTop=e,s&&s.FBALTOVERFLOW&&this.$el.css({"overflow-y":"scroll",display:"block"})},m.prototype.show=function(){this.positionModal(),this.$el.css({display:"block"}),C.onFeedbackShown.fire(this.$el)},m.prototype.focusOnBadge=function(){var e=this.instcfg.badge&&this.instcfg.badge.$el;e&&e.focus()},m.prototype._trapKeyBoard=function(s,n){n=n||s,utils.Bind(document.body,"feedbackModal:focus",function(e){var t=(e=e||window.event).target||e.srcElement,i=document.getElementById("acsMainInvite")||document.getElementById("fsrInvite");i&&utils.DOMContains(i,t)||utils.DOMContains(s,t)||n&&(e.stopPropagation(),n.focus())},!1)},m.prototype._getSurveyData=function(){if(this.sv.isExpired())this.networkError.fire({type:"expired"});else{var e={mid:this.sv.cfg.mid,cachebust:(new Date).getTime()};this.sv.cfg.version&&(e.version=this.sv.cfg.version),this._surveyTimer=setTimeout(function(){this.networkError.fire({type:"timedout"})}.bind(this),1e4),this.ajax.send({url:this.sv.cfg.datauri,data:e,method:"GET",skipEncode:!1,success:function(e){this.networkError.didFire||(clearTimeout(this._surveyTimer),this.sv.SurveyData.fire(e,function(e){this.survey=e,this.renderSurvey()}.bind(this)))}.bind(this),failure:function(e){this.networkError.didFire||this.networkError.fire({type:"getdata_failed"})}.bind(this)})}},m.prototype._postSurveyData=function(t){if(this.cfg.preview)fs.nextTick(function(){t&&t()});else{var e=JSON.parse(this.sv._serialize());this.jrny&&this.jrny.config&&this.jrny.config.disable_cpps&&-1<this.jrny.config.disable_cpps.indexOf("url")&&(e.url=""),fs.isArray(e.responses)&&e.responses.push({questionId:"deployment_type",answerText:"BADGE"}),C.onFeedbackSubmitted.fire(fs.ext({rating:this.sv._getScore()},e)),this._surveyTimer=setTimeout(function(){this.networkError.fire({type:"timedout"})}.bind(this),1e4),this.ajax.send({method:"POST",url:this.cfg.posturi,data:e,contentType:"application/json",success:function(e){clearTimeout(this._surveyTimer),t&&t()}.bind(this),failure:function(e){clearTimeout(this._surveyTimer),sessionStorage.setItem("acsFeedbackSubmitted","true"),this.networkError.fire({type:"postdata_failed"})}.bind(this)})}};var b=function(e,t,i){this.height=600,this.width=400,this.survey=e,this.cfg=t,this.cpps=e.cpps,this.SurveySubmitted=new utils.FSEvent,this.br=i,this.jrny=t.jrny,this.networkError=utils.FSEvent()};b.prototype._getCXRParams=function(){var e="";return!0===this.cfg.replay&&void 0!==g&&(e+="cxrid="+fs.enc(g.getGlobalId())+"&cxrurl="+fs.enc(fs.config.recUrl)),e},b.prototype.show=function(){if(!this.winRef){var e,t=this.cfg.preview?null:JSON.stringify(this.cpps.all()),i=this._getCXRParams(),s=this,n=window,r=this.cfg.badge&&this.cfg.badge.btncfg&&this.cfg.badge.btncfg.mid?this.cfg.badge.btncfg.mid:this.cfg.mid,o={global:fs.config,product:this.cfg.preview?null:function(e,t){for(var i=fs.ext({},t),s=0;s<i.instances.length;s++)if(e===i.instances[s].mid){i.instances=[i.instances[s]];break}return i}(r,C.config)},a=["&_gwl_=",fs.enc(fs.home),"&_cv_=",fs.enc(fs.config.codeVer),"&_au_=",fs.enc(fs.config.analyticsUrl),"&_vt_=",fs.enc(fs.tagVersion),"&_issh_=",fs.enc(fs.isSelfHosted),"&_pa_=",fs.enc(fs.assetLocation),fs.codeLocation?"&_cl_="+fs.enc(fs.codeLocation):""].join("");if(this.cfg.preview)e=fs.makeURI(["$fs.feedbacksurvey.html?mid=",fs.enc(this.survey.cfg.mid),"&t=",fs.enc(this.cfg.template||"default"),"&datauri=",fs.getParam("datauri"),"&ns=",fs.enc("preview"),"&_gcfg_=",fs.enc(utils.Compress.compress(fs.enc(JSON.stringify(o)))),a].join(""));else e=fs.makeURI(["$fs.feedbacksurvey.html?","&t=",fs.enc(this.cfg.template||"default"),"&fsUrl=",fs.enc(n.location.href),"&uid=",fs.enc(C.stg.uid),"&ns=",fs.enc(fs.config.siteKey),"&brain=",fs.enc(fs.config.brainUrl),a,"&",i].join("")),utils.getBrainStorage(this.br,C.stg.uid,this.cfg.preview?"preview":fs.config.siteKey).set("fscfg",{gcfg:fs.enc(utils.Compress.compress(fs.enc(JSON.stringify(o)))),cid:fs.enc(this.jrny.data.customerId),mid:r,cpps:fs.enc(utils.Compress.compress(t))});this.br.isIE&&this.br.browser.actualVersion<=11&&("//"==e.substr(0,2)&&(e="https:"+e),"http"==e.substr(0,4)&&e.replace("http","https")),this.cfg.preview&&(n!==n.top||-1<n.location.toString().indexOf("fscommand=feedbackpreview"))?n.location.href=e:(this.winRef=n.open(e,"_system"),this._checkerFailsAllowed=20,this._checker=setInterval(function(){try{var e=s.winRef.location+"",t="fsSurveyComplete=";if(-1<e.indexOf(t)){clearInterval(s._checker);var i=utils.Compress.decompress(decodeURIComponent(e.substr(e.indexOf(t)+t.length)));C.onFeedbackSubmitted.fire(JSON.parse(i)),s.SurveySubmitted.fire(JSON.parse(i))}}catch(e){if(0<s._checkerFailsAllowed)return void s._checkerFailsAllowed--;clearInterval(s._checker),s.SurveySubmitted.fire()}},500))}C.onFeedbackShown.fire(this.winRef)},utils.registerProduct("feedback"),_=fs.ext({browser_cutoff:{Edge:1,IE:11,IEMobile:10,Safari:5.2,Firefox:30,Chrome:30,Opera:1e3},platform_cutoff:{Android:5,Winphone:7.4,iPod:9,iPhone:9,iPad:9},config:{persistence:utils.products.foresee?utils.products.foresee.config.persistence:utils.storageTypes.CK}},_);var P=[],M=window.location,v=function(){var m=!!utils.getHashParm("previewmode"),b=!!fs.getParam("previewbadgemode"),v=_.instances,g=[],y=!1;if(M=JSON.parse(JSON.stringify(window.location)),v||m||b){var w=new utils.Browser;w.ready.subscribe(function(){var u=utils.getGeneralStorage(w);u.ready.subscribe(function(){if(m){new F(w).show()}else{var e=new E(w,_),n=new utils.CPPS(u),t=fs.config.adobeRsid;utils.initBehavioralData(fs.config.customerId||utils.getRootDomain()||"feedback_customerId",u,w,n),n.set("code",fs.config.codeVer),n.set("tz",-(new Date).getTimezoneOffset()),n.set("env",fs.isProduction?"prd":"stg"),utils.INT.GA.has()&&utils.INT.GA.uid(function(e){e&&n.set("GA_ID",e)});function i(e){n.set(e.name,e.value)}if(utils.INT.OM.uid(t,i),utils.INT.OM.mcid(t,i),utils.INT.OM.beacon(function(e){n.set("OMTR_BEACON",e)}),b){var s=JSON.parse(fs.getParam("cfg")),r=fs.getQueryString("previewbadgemode")||"desktop";s.mid&&(s.previewMode=r,new x(s,w,n).renderBadge())}else if(e.platformOK()){T(n,w,u),C.pageResetFn=function(){function e(e){var t=(e=e||"").split("#");return 2<t.length?t[0]+t[1]:e.replace(/#/gi,"")}var t,i=window.location;e(M.hash)==e(i.hash)&&M.pathname==i.pathname||fsReady(function(){clearTimeout(t),t=setTimeout(function(){var e=fs.API.retrieveFromAPI("resetFeedback");fs.isFunction(e)&&e()},1e3)})},utils.pageNavEvent.subscribe(C.pageResetFn,!1,!1);for(var o=0;o<v.length;o++){var a=v[o],c=!1;if(k.TopicTester(a)&&a.topics&&a.topics.length)for(var d=0;d<a.topics.length;d++)if(k.TopicTester(a.topics[d])){c=!0;break}if(!0===a.replay&&!1===a.disabled&&(y=!0,"y"!=u.get("fbr")&&u.set("fbr","y")),(c||a.topics&&0===a.topics.length)&&!a.disabled&&window==window.top){var h=!1;a.template||(a.template="default");for(var l=0;l<g.length;l++)g[l]===a.template&&(h=!0);h||g.push(a.template),a.jrny=new utils.Journey({customerId:fs.config.customerId||utils.getRootDomain()||"feedback_customerId",appId:utils.APPID.FEEDBACK,stg:u,browser:w,throttleDuration:1e3,useSessionId:!0,usePopupId:!1}),P.push(a)}}if(0<P.length){var f,p=0<g.length?g:["default"];new j(w,n,p).loadSuccess.subscribe(function(e){for(var t=0;t<P.length;t++){var i=P[t];if("badge"===$(i,w)){0==t&&w.isIE&&((f=document.createElement("div")).className="acs-feedback__forcefont",document.body.appendChild(f));var s=e[i.template];i.badge=new S(i,w,n,s.typeTemplate,s.emTemplate,!0),i.badge.setBtnTemplate(),i.badge.surveyTriggered.subscribe(function(e){return function(){!0===e.replay&&B.startTransmitting(w,n,e),i.jrny.initPopupId(),I.initialize(e,w,n,s.emTemplate,s.svContentsTemplate,s.epTemplate)}}(i),!1,!1)}}I.SurveySubmitted.subscribe(function(e){var t,i;if(e&&e.mid)for(B.startProcessing(w,n,e),t=0;t<P.length;t++)P[t].badge&&P[t].mid===e.mid&&P[t].badge.remove();else for(i=0;i<P.length;i++)P[i].badge&&P[i].badge.remove()})}.bind(this),!0,!0)}y&&B&&B.setup(w,n,P[0],function(e){for(var t=0;t<P.length;t++)P[t].stg=O,P[t].record=e})}}}.bind(this),!0,!0)},!0,!0)}};fs.domReady(v);var g=null,O=null,y=utils.now(),B={setup:function(s,n,e,r){if(fs.isDefined(fs.config.products.record)&&!1===fs.config.products.record||!fs.productConfig.record)fs.nextTick(r);else{var t="$fs.record.js";fs.config.modernRecord&&(t="$fs.rec.js"),i([fs.makeURI(t),"recordconfig"],function(e,t){t,O=O||utils.getGeneralStorage(s);var i={id:fs.config.customerId||utils.getRootDomain()||"feedback_customerId"};g=e.getInstance(s,window,O,i,n),r(g)})}},startProcessing:function(e,t,i){B.startTransmitting(e,t,i,function(e){e&&e.recorder&&e.recorder.processImmediately(Math.max(2e4-(utils.now()-y),0))})},dispose:function(){g&&(g.dispose(),g=null)},startTransmitting:function(e,t,i,s){y=utils.now(),!0===i.replay&&(g?(g.beginTransmitting(),s&&s(g)):B.setup(e,t,i,function(e){e.beginTransmitting(),s&&s(e)}))}}}});